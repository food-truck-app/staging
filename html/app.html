<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Food Truck App</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <style type="text/css">
      body {
        padding-top: 100px;
      }
    </style>
  </head>
  <body>
    <div class="container" id="main-body-container">
      <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8" id="main">
          <p id="loading">Loading...</p>
        </div>
        <div class="col-md-2"></div>
      </div>
    </div>
    <script type="text/javascript">
      //This code comes from Dancrumb at http://stackoverflow.com/questions/5984179/javascript-geocoding-from-address-to-latitude-and-longitude-numbers-not-working
      var geocoder = new google.maps.Geocoder();
      var address = "Republican St and Boren Avenue";
      
      geocoder.geocode( { 'address': address}, function(results, status) {
      
        if (status == google.maps.GeocoderStatus.OK) {
          var latitude = results[0].geometry.location.lat();
          var longitude = results[0].geometry.location.lng();
          alert(latitude);
        } 
      }); 
      //end code
      
      function logout() {
        sessionStorage.clear();
        window.location = '/';
      }

      function initMap() {
        $('#loading').remove();
        $('#main').append('<div id="map" style="width: 100%; height: 400px;"></div>');
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 15,
          center: new google.maps.LatLng(47.623553, -122.335827),
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        var locations = [
          ['Buddah Bruddah', 47.623234, -122.337325, 3],
          ['Tacos El Tajin', 47.623390, -122.335783, 2],
          ['Djung On Wheels', 47.623393, -122.335858, 1]
        ];
        var infowindow = new google.maps.InfoWindow();

        var marker, i;
        
        for (i = 0; i < locations.length; i++) {  
          marker = new google.maps.Marker({
            position: new google.maps.LatLng(locations[i][1], locations[i][2]),
            map: map
          });
        
          google.maps.event.addListener(marker, 'click', (function(marker, i) {
            return function() {
              infowindow.setContent(locations[i][0]);
              infowindow.open(map, marker);
            }
          })(marker, i));
        }
      }

      $(document).ready(function() {
        if (!sessionStorage.getItem('app_token')) logout();
        initMap();
      });

      // function getLocation() {
      //   if ('geolocation' in navigator) {
      //     var coords = navigator.geolocation.getCurrentPosition(function(position) {
      //       return [position.coords.latitude, position.coords.longitude];
      //     });
      //     return coords;
      //   } else {
      //     return false;
      //   }
      // }

      // function loadMap(coords) {
      //   var map = new google.maps.Map(document.getElementById('map'), {
      //     zoom: 10,
      //     center: new google.maps.LatLng(coords[0], coords[1]),
      //     mapTypeId: google.maps.mapTypeId.ROADMAP
      //   });
      // }

      // $(document).ready(function() {
      //   if (!sessionStorage.getItem('app_token')) logout();
      //   var coords = getLocation();
      //   // initMap();
      //   // loadMap(coords);
      // });

// embed api key AIzaSyBWHuuF3VuRKhNtj8Uqe03TrDvSlOzYlus
// maps api key AIzaSyDrmao1qmYbtSPldTh1JQFiH4SOwDROENM
    </script>
  </body>
</html>
